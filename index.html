<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>çªå›Šè´¹è®¡ç®—å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f6fa;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .timer, .income {
            margin: 20px 0;
            font-size: 2.2rem;
            color: #222f3e;
            font-weight: bold;
        }
        .income {
            font-size: 2.8rem;
            color: #ff0800;
        }
        .label {
            font-size: 1.2rem;
            color: #576574;
        }
    </style>
</head>
<body>
    <div class="container">
        <form id="settingForm" style="margin-bottom:30px;text-align:center;">
            <label>æœˆå·¥èµ„(å…ƒ)ï¼š<input type="number" id="salaryInput" min="1" value="" style="width:100px;"></label>
            <button type="button" id="toggleVisibility" style="margin-left:8px;padding:2px 8px;cursor:pointer;font-size:0.9rem;">ğŸ‘ï¸</button>
            <label style="margin-left:20px;">ä¸‹ç­æ—¶é—´ï¼š<input type="time" id="offTimeInput" value="18:00" style="width:90px;"></label>
        </form>
        <div class="timer" id="timer">ä¸‹ç­å€’è®¡æ—¶ï¼š--:--:--</div>
        <div class="timer" id="overtime" style="display:none;color:#ff6b6b;">åŠ ç­æ—¶é•¿ï¼š00:00:00</div>
        <div class="label" id="incomeLabel">ä»Šæ—¥çªå›Šè´¹æ”¶å…¥ï¼š</div>
        <div class="income" id="income">ï¿¥0.00</div>
        <div id="tip" style="margin-top:18px;font-size:1.1rem;color:#009966;text-align:center;"></div>
    </div>
    <script>
        let salary = 0;
        let offHour = 18, offMinute = 0;
        let dailySalary = 0;
        let workStartHour = 9, workStartMinute = 30;

        // ä»localStorageåŠ è½½ä¿å­˜çš„è®¾ç½®
        function loadSettings() {
            const savedSalary = localStorage.getItem('salary');
            const savedOffTime = localStorage.getItem('offTime');
            const savedVisibility = localStorage.getItem('salaryVisible');
            if (savedSalary) {
                document.getElementById('salaryInput').value = savedSalary;
            }
            if (savedOffTime) {
                document.getElementById('offTimeInput').value = savedOffTime;
            }
            // æ¢å¤å¯è§æ€§çŠ¶æ€ï¼Œé»˜è®¤æ˜¾ç¤º
            if (savedVisibility === 'false') {
                toggleSalaryVisibility();
            }
        }

        // ä¿å­˜è®¾ç½®åˆ°localStorage
        function saveSettings() {
            const salaryValue = document.getElementById('salaryInput').value;
            const offTimeValue = document.getElementById('offTimeInput').value;
            if (salaryValue) {
                localStorage.setItem('salary', salaryValue);
            }
            if (offTimeValue) {
                localStorage.setItem('offTime', offTimeValue);
            }
        }

        // åˆ‡æ¢å·¥èµ„æ˜¾ç¤º/éšè—
        function toggleSalaryVisibility() {
            const salaryInput = document.getElementById('salaryInput');
            const toggleBtn = document.getElementById('toggleVisibility');
            if (salaryInput.type === 'number') {
                salaryInput.type = 'password';
                toggleBtn.textContent = 'ğŸ™ˆ';
                localStorage.setItem('salaryVisible', 'false');
            } else {
                salaryInput.type = 'number';
                toggleBtn.textContent = 'ğŸ‘ï¸';
                localStorage.setItem('salaryVisible', 'true');
            }
        }

        function getWorkdays(year, month) {
            let count = 0;
            let date = new Date(year, month, 1);
            while (date.getMonth() === month) {
                let day = date.getDay();
                if (day !== 0 && day !== 6) count++;
                date.setDate(date.getDate() + 1);
            }
            return count;
        }
        function isWorkday(date) {
            let day = date.getDay();
            return day !== 0 && day !== 6;
        }
        function pad(n) { return n < 10 ? '0' + n : n; }

        function getOffWorkTime(date) {
            let off = new Date(date);
            off.setHours(offHour, offMinute, 0, 0);
            return off;
        }
        function getWorkStartTime(date) {
            let start = new Date(date);
            start.setHours(workStartHour, workStartMinute, 0, 0);
            return start;
        }

        function update() {
            const now = new Date();
            const timerElem = document.getElementById('timer');
            const incomeElem = document.getElementById('income');
            const incomeLabel = document.getElementById('incomeLabel');
            // è·å–è¾“å…¥
            salary = parseFloat(document.getElementById('salaryInput').value);
            const offTime = document.getElementById('offTimeInput').value;
            if (!/^\d{2}:\d{2}$/.test(offTime)) {
                timerElem.textContent = 'è¯·å¡«å†™ä¸‹ç­æ—¶é—´';
                incomeElem.textContent = 'ï¿¥0.00';
                return;
            }
            [offHour, offMinute] = offTime.split(':').map(Number);
            if (isNaN(salary) || salary <= 0) {
                timerElem.textContent = 'è¯·å¡«å†™æœ‰æ•ˆçš„æœˆå·¥èµ„';
                incomeElem.textContent = 'ï¿¥0.00';
                return;
            }
            // è®¡ç®—æœ¬æœˆå·¥ä½œæ—¥å¤©æ•°
            const year = now.getFullYear();
            const month = now.getMonth();
            const workdays = getWorkdays(year, month);
            dailySalary = salary / workdays;
            if (!isWorkday(now)) {
                timerElem.textContent = 'ä»Šå¤©ä¸æ˜¯å·¥ä½œæ—¥ï¼Œçªå›Šè´¹æš‚åœè®¡å…¥';
                incomeElem.textContent = 'ï¿¥0.00';
                return;
            }
            // ä¸‹ç­å€’è®¡æ—¶
            const offWork = getOffWorkTime(now);
            const overtimeElem = document.getElementById('overtime');
            let diff = offWork - now;
            if (diff < 0) {
                // åŠ ç­ä¸­
                timerElem.style.display = 'none';
                overtimeElem.style.display = 'block';
                let overtimeDiff = now - offWork;
                let oh = Math.floor(overtimeDiff / 3600000);
                let om = Math.floor((overtimeDiff % 3600000) / 60000);
                let os = Math.floor((overtimeDiff % 60000) / 1000);
                overtimeElem.textContent = `åŠ ç­æ—¶é•¿ï¼š${pad(oh)}:${pad(om)}:${pad(os)}`;
                // è®¡ç®—åŠ ç­åˆ†é’Ÿæ•°ï¼Œæ¯15åˆ†é’Ÿå¤šä¸€ä¸ªæ„Ÿå¹å·
                let overtimeMinutes = Math.floor(overtimeDiff / 60000);
                let exclamations = Math.floor(overtimeMinutes / 15) + 1;
                document.getElementById('tip').textContent = 'æ€ä¹ˆè¿˜åœ¨åŠ ç­ï¼Œæ‰¹è¯„' + 'ï¼'.repeat(exclamations);
                document.getElementById('tip').style.color = '#ff6b6b';
            } else {
                timerElem.style.display = 'block';
                overtimeElem.style.display = 'none';
                diff = Math.max(0, diff);
                let h = Math.floor(diff / 3600000);
                let m = Math.floor((diff % 3600000) / 60000);
                let s = Math.floor((diff % 60000) / 1000);
                timerElem.textContent = `ä¸‹ç­å€’è®¡æ—¶ï¼š${pad(h)}:${pad(m)}:${pad(s)}`;
                // æ¢å¤æ­£å¸¸æç¤ºè¯­
                if (document.getElementById('tip').style.color === 'rgb(255, 107, 107)') {
                    showTip();
                    document.getElementById('tip').style.color = '#009966';
                }
            }

            // è®¡ç®—ä»Šæ—¥å·²è·å¾—çªå›Šè´¹
            let workStart = getWorkStartTime(now);
            let workEnd = getOffWorkTime(now);
            let totalWorkMs = workEnd - workStart;
            let earned = 0;
            if (now < workStart) {
                earned = 0;
            } else if (now > workEnd) {
                earned = dailySalary;
            } else {
                earned = dailySalary * ((now - workStart) / totalWorkMs);
            }
            incomeElem.textContent = 'ï¿¥' + earned.toFixed(2);
        }

        document.getElementById('salaryInput').addEventListener('input', () => {
            saveSettings();
            update();
        });
        document.getElementById('offTimeInput').addEventListener('input', () => {
            saveSettings();
            update();
        });
        document.getElementById('toggleVisibility').addEventListener('click', toggleSalaryVisibility);
        loadSettings();
        setInterval(update, 1000);
        update();

        // åŠ±å¿—è¯­å½•
        const tips = [
            'è®°å¾—å–æ°´ï¼',
            'æ´»åŠ¨ä¸€ä¸‹å§~',
            'å°å¿ƒè…°å“¦ï¼',
            'æ‘¸é±¼æé†’ï¼',
            'ä¸Šç­è¾›è‹¦å•¦ï¼',
            'å®å®æ£’æ£’ï¼Œç»§ç»­åŠ æ²¹ï¼'
        ];
        function showTip() {
            const tipElem = document.getElementById('tip');
            const idx = Math.floor(Math.random() * tips.length);
            tipElem.textContent = tips[idx];
        }
        showTip();
        setInterval(showTip, 600000); // 10åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html>
